<template>
    <require from="../resources/elements/status/status"></require>
    <require from="../resources/elements/api-errors/api-errors"></require>

    <status status.bind="status"></status>
    <api-errors errors.bind="apiErrors"></api-errors>    

    <div class="row actions">
        <div class="col-sm-12">
            <a class="btn btn-primary btn-lg" href="#employer/" role="button">Add a new employer</a>
        </div>
    </div>

    <table class="table" if.bind="employers.length > 0">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">PAYE Ref</th>
                <th scope="col">Pay Schedules
                    <div class="row th-subheader">
                        <div class="col-sm-12 col-md-12">
                            <div class="row">
                                <div class="col-sm-4">
                                    Name
                                </div>      
                                <div class="col-sm-2">
                                    Pay Frequency
                                </div>   
                                <div class="col-sm-2">
                                    Employees
                                </div>   
                                <div class="col-sm-2">
                                    Last Pay Date
                                </div>   
                                <div class="col-sm-2">
                                    Next Pay Date
                                </div>   
                            </div>
                        </div>
                    </div>
                </th>
                <th scope="col" style="width:50px;"></th>
            </tr>
        </thead>
        <tbody>
            <tr repeat.for="employer of employers">
                <th scope="row">
                    <a href="#employer/${employer.Key}">
                        ${employer.Name}
                    </a>
                </th>
                <td>${employer.TaxOfficeNumber}/${employer.TaxOfficeReference}</td>
                <td>
                    <div class="row" if.bind="employer.PaySchedule.length > 0">
                        <div class="col-sm-12 col-md-12">
                            <div class="row" repeat.for="paySchedule of employer.PaySchedule">
                                <div class="col-sm-4">
                                    ${paySchedule.Name}
                                </div>      
                                <div class="col-sm-2">
                                    ${paySchedule.PayFrequency}
                                </div>   
                                <div class="col-sm-2">
                                    ${paySchedule.EmployeeCount}
                                </div> 
                                <div class="col-sm-2">
                                    <span if.bind="paySchedule.LastPayDay">${paySchedule.LastPayDay}</span>
                                    <span if.bind="!paySchedule.LastPayDay">
                                        <em>Never</em>
                                    </span>
                                </div>
                                <div class="col-sm-2">
                                    <span if.bind="paySchedule.NextPayDay">${paySchedule.NextPayDay}</span>
                                    <span if.bind="!paySchedule.NextPayDay">-</span>
                                </div>     
                            </div>
                        </div>
                    </div>

                    <a if.bind="employer.PaySchedule.length === 0"
                        class="btn btn-sm btn-default launch-modal" 
                        data-modal-title="Add Pay Schedule"
                        href="#employer/${employer.Key}/paySchedule/new" 
                        role="button">Add a Pay Schedule</a>
                </td>
                <td>
                    <button type="button" 
                        class="btn btn-danger btn-sm" 
                        click.delegate="deleteEmployer(employer.Key)">
                        Delete
                    </button>                      
                </td>
            </tr>
      </tbody>
    </table>
</template>