<template>
    <require from="../../resources/elements/bank-account-form/bank-account-form"></require>
    <require from="../../resources/elements/address-form/address-form"></require>
    <require from="../../resources/elements/rule-exclusions/rule-exclusions"></require>
    <require from="../../resources/elements/pay-schedule-dropdown/pay-schedule-dropdown"></require>
    <require from="../../resources/elements/validation-errors/validation-errors"></require>
    <require from="../../resources/elements/api-errors/api-errors"></require>
    <require from="../../resources/elements/status/status"></require>
        
    <validation-errors errors.bind="validationController.errors"></validation-errors>
    
    <api-errors errors.bind="apiErrors"></api-errors>

    <status status.bind="status"></status>

    <form>
        <ul class="nav nav-pills nav-fill" id="subTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="details-tab" data-toggle="tab" href="#details" role="tab" aria-controls="details" aria-selected="true">Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tax-tab" data-toggle="tab" href="#tax" role="tab" aria-controls="tax" aria-selected="false">Tax &amp; NI</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="ae-tab" data-toggle="tab" href="#ae" role="tab" aria-controls="ae" aria-selected="false">Auto Enrolment</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="partner-tab" data-toggle="tab" href="#partner" role="tab" aria-controls="partner" aria-selected="false">Partner Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="advanced-tab" data-toggle="tab" href="#advanced" role="tab" aria-controls="advanced" aria-selected="false">Advanced</a>
            </li>
            <li class="nav-item" if.bind="employee.Id">
                <a class="nav-link" id="revisions-tab" data-toggle="tab" href="#revisions" role="tab" aria-controls="revisions" aria-selected="false">Revisions</a>
            </li>            
        </ul>

        <div class="tab-content" id="mySubTabContent">

            <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">

                <div class="row">
                    <div class="col-sm-12 col-md-4">
                        <div class="form-group">
                            <label for="LastName">Last name</label>
                            <input type="text" 
                                class="form-control form-control-lg" 
                                id="LastName" 
                                name="LastName" 
                                value.bind="employee.LastName & validate" 
                                placeholder="Last name"
                                maxlength="35">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-2">
                        <div class="form-group">
                            <label for="Code">Code</label>
                            <input type="text" 
                                class="form-control form-control-lg" 
                                id="Code" 
                                name="Code" 
                                value.bind="employee.Code & validate" 
                                placeholder="Unique code also known as the Payroll Id"
                                maxlength="35">

                            <span class="notes" The code must be unique to Employer and never reused.></span>
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-3">
                        <div class="form-group">
                            <label for="StartDate">Start date</label>
                            <input type="date" 
                                class="form-control form-control-lg" 
                                id="StartDate" 
                                name="StartDate" 
                                value.bind="employee.StartDate" 
                                placeholder="Start date">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-3">
                        <div class="form-group">
                            <label for="EffectiveDate">Effective date</label>
                            <input type="date" 
                                class="form-control form-control-lg" 
                                id="EffectiveDate" 
                                name="EffectiveDate" 
                                value.bind="employee.EffectiveDate & validate"
                                placeholder="Date the revision will come into effect">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-md-1">
                        <div class="form-group">
                            <label for="Title">Title</label>
                            <input type="text" 
                                class="form-control title" 
                                id="Title" 
                                name="Title" 
                                value.bind="employee.Title" 
                                placeholder="Title" 
                                maxlength="35">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-5">
                        <div class="form-group">
                            <label for="FirstName">First name</label>
                            <input type="text" 
                                class="form-control" 
                                id="FirstName" 
                                name="FirstName" 
                                value.bind="employee.FirstName" 
                                placeholder="First name" 
                                maxlength="35">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-1">
                        <div class="form-group">
                            <label for="Initials">Initials</label>
                            <input type="text" 
                                class="form-control initials" 
                                id="Initials" 
                                name="Initials" 
                                value.bind="employee.Initials" 
                                placeholder="Initials"
                                maxlength="35">
                        </div>
                    </div>
                    <div class="col-sm-12 col-md-5">
                        <div class="form-group">
                            <label for="MiddleName">Middle name(s)</label>
                            <input type="text" 
                                class="form-control" 
                                id="MiddleName" 
                                name="MiddleName" 
                                value.bind="employee.MiddleName" 
                                placeholder="Middle name(s) if any"
                                maxlength="35">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-md-6">

                        <div class="row">
                            <div class="col-sm-12 col-md-6">
                                <div class="form-group">
                                    <label for="DateOfBirth">Date of birth</label>
                                    <input type="date" 
                                        class="form-control" 
                                        id="DateOfBirth" 
                                        name="DateOfBirth" 
                                        value.bind="employee.DateOfBirth & validate" 
                                        placeholder="Date of birth">
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-6">
                                <div class="form-group">
                                    <label for="Gender">Gender</label>

                                    <select class="form-control" 
                                        id="Gender" 
                                        name="Gender" 
                                        value.bind="employee.Gender & validate">
                                        <option value=""></option>
                                        <option value="Unknown">Unknown</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <pay-schedule-dropdown payschedule.bind="employee.PaySchedule" payschedules.bind="paySchedules"></pay-schedule-dropdown>

                        <bank-account-form bankaccount.bind="employee.BankAccount"></bank-account-form>
                    </div>

                    <div class="col-sm-12 col-md-6">
                        <address-form address.bind="employee.Address"></address-form>
                    </div>
                </div>

            </div>

            <div class="tab-pane fade" id="tax" role="tabpanel" aria-labelledby="tax-tab">

                <div class="form-group">
                    <label for="StarterDeclaration">Starter declaration</label>

                    <select class="form-control" 
                        id="StarterDeclaration" 
                        name="StarterDeclaration" 
                        value.bind="employee.StarterDeclaration & validate">
                        <option value=""></option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="NA">N/A</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="NiNumber">Ni Number</label>
                    <input type="text" class="form-control" id="NiNumber" name="NiNumber" value.bind="employee.NiNumber" placeholder="Ni Number">

                    <span class="notes">The employee's National Insurance number issued by HMRC. Temporary NI numbers should no longer be used
                        for payroll.</span>
                </div>

                <div class="form-group">
                    <label for="DirectorshipAppointmentDate">Directorship appointment date</label>
                    <input type="date" 
                        class="form-control" 
                        id="DirectorshipAppointmentDate" 
                        name="DirectorshipAppointmentDate" 
                        value.bind="employee.DirectorshipAppointmentDate"
                        placeholder="Directorship appointment date">
                </div>

                <div class="form-group">
                    <label for="NicLiability">Nic Liability</label>

                    <select class="form-control" id="NicLiability" name="NicLiability" multiple value.bind="employee.NicLiability">
                        <option value="IsFullyLiable">IsFullyLiable</option>
                        <option value="HasOtherJob">HasOtherJob</option>
                        <option value="IsFemaleEntitledToReducedRate">IsFemaleEntitledToReducedRate</option>
                        <option value="IsNotLiable">IsNotLiable</option>
                        <option value="IsContractedOut">IsContractedOut</option>
                        <option value="IsApprentice">IsApprentice</option>
                        <option value="LeaverBeyond6Weeks">LeaverBeyond6Weeks</option>
                    </select>

                    <span class="notes">
                        The NIC liability flags are used to ensure the correct NI letter is assigned. See
                        <a href="http://developer.payrun.io/docs/getting-started/using-the-correct-ni-letter-code.html" target="_blank">Using the correct NI letter code</a> for more information on setting the correct NIC liability flags.
                    </span>
                </div>
            </div>

            <div class="tab-pane fade" id="ae" role="tabpanel" aria-labelledby="ae-tab">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label for="AEAssessmentOverride">AEAssessment override</label>

                            <select class="form-control" id="AEAssessmentOverride" name="AEAssessmentOverride" value.bind="employee.AEAssessmentOverride">
                                <option value=""></option>
                                <option value="None">Not set</option>
                                <option value="OptOut">Opt out</option>
                                <option value="OptIn">Opt in</option>
                                <option value="VoluntaryJoiner">Voluntary joiner</option>
                                <option value="ContractualPension">Contractual pension</option>
                                <option value="CeasedMembership">Ceased membership</option>
                                <option value="Leaver">Leaver</option>
                                <option value="Excluded" Excluded></option>
                            </select>

                            <span class="notes">
                                The auto enrolment assessment override value. Enables the auto enrolment assessment result to be overridden
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="AEAssessmentOverrideDate">Assessment override date</label>
                            <input type="date" 
                                class="form-control" 
                                id="AEAssessmentOverrideDate" 
                                name="AEAssessmentOverrideDate" 
                                value.bind="employee.AEAssessmentOverrideDate"
                                placeholder="Assessment override date">

                            <span class="notes">
                                The auto enrolment assessment override date. Determines the date when auto enrolment assessment override applies.
                            </span>
                        </div>

                        <div class="form-group">
                            <label for="AEPostponementDate">Postponement date</label>
                            <input type="date" 
                                class="form-control" 
                                id="AEPostponementDate" 
                                name="AEPostponementDate" 
                                value.bind="employee.AEPostponementDate"
                                placeholder="Postponement date">

                            <span class="notes">
                                The auto enrolment deferment date. Indicates the date when auto enrolment assessments are deferred to.
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="partner" role="tabpanel" aria-labelledby="partner-tab">
                <div class="row">
                    <div class="col-sm-12">
                        <span class="intro">The details of the employee's partner only need be provided when claiming ShPP.</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-6">                
                        <div class="form-group">
                            <label for="EmployeePartner_Title">Title</label>
                            <input type="text" 
                                class="form-control title" 
                                id="EmployeePartner_Title" 
                                name="EmployeePartner[Title]" 
                                value.bind="employee.EmployeePartner.Title"
                                placeholder="Title" 
                                maxlength="35">
                        </div>

                        <div class="form-group">
                            <label for="EmployeePartner_FirstName">First name</label>
                            <input type="text" 
                                class="form-control" 
                                id="EmployeePartner_FirstName" 
                                name="EmployeePartner[FirstName]" 
                                value.bind="employee.EmployeePartner.FirstName"
                                placeholder="First name" 
                                maxlength="35">
                        </div>

                        <div class="form-group">
                            <label for="EmployeePartner_Initials">Initials</label>
                            <input type="text" 
                                class="form-control initials" 
                                id="EmployeePartner_Initials" 
                                name="EmployeePartner[Initials]" 
                                value.bind="employee.EmployeePartner.Initials"
                                placeholder="Initials" 
                                maxlength="35">

                            <span class="notes">The employee's initial, if not supplying a first name</span>
                        </div>
                    </div>

                    <div class="col-sm-6"> 
                        <div class="form-group">
                            <label for="EmployeePartner_MiddleName">Middle name(s)</label>
                            <input type="text" 
                                class="form-control" 
                                id="EmployeePartner_MiddleName" 
                                name="EmployeePartner[MiddleName]" 
                                value.bind="employee.EmployeePartner.MiddleName"
                                placeholder="Middle name(s) if any" 
                                maxlength="35">
                        </div>

                        <div class="form-group">
                            <label for="EmployeePartner_LastName">Last name</label>
                            <input type="text" 
                                class="form-control" 
                                id="EmployeePartner_LastName" 
                                name="EmployeePartner[LastName]" 
                                value.bind="employee.EmployeePartner.LastName"
                                placeholder="Last name" 
                                maxlength="35">
                        </div>

                        <div class="form-group">
                            <label for="EmployeePartner_NiNumber">Ni Number</label>
                            <input type="text" 
                                class="form-control" 
                                id="EmployeePartner_NiNumber" 
                                name="EmployeePartner[NiNumber]" 
                                value.bind="employee.EmployeePartner.NiNumber"
                                placeholder="Ni Number">

                            <span class="notes">The employee's National Insurance number issued by HMRC. Temporary NI numbers should no longer
                                be used for payroll.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">

                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="row">
                            <div class="col-sm-12 col-md-8">
                                <div class="form-group" >
                                    <label for="Territory">Territory</label>

                                    <select class="form-control" id="Territory" name="Territory" value.bind="employee.Territory & validate">
                                        <option value=""></option>
                                        <option value="UnitedKingdom">United Kingdom</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-4">
                                <div class="form-group">
                                    <label for="Region">Region</label>

                                    <select class="form-control" id="Region" name="Region" value.bind="employee.Region & validate">
                                        <option value=""></option>
                                        <option value="England">England</option>
                                        <option value="Scotland">Scotland</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="PaymentMethod">Payment method</label>

                            <select class="form-control" id="PaymentMethod" name="PaymentMethod" value.bind="employee.PaymentMethod">
                                <option value=""></option>
                                <option value="NotSet">Not set</option>
                                <option value="Cash">Cash</option>
                                <option value="Cheque">Cheque</option>
                                <option value="BACS">BACS</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="MaritalStatus">Marital status</label>

                            <select class="form-control" id="MaritalStatus" name="MaritalStatus" value.bind="employee.MaritalStatus">
                                <option value=""></option>
                                <option value="NotSet">Not set</option>
                                <option value="Single">Single</option>
                                <option value="Married">Married</option>
                                <option value="Divorced">Divorced</option>
                                <option value="Widowed">Widowed</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="PassportNumber">Passport number</label>
                            <input type="text" class="form-control" id="PassportNumber" name="PassportNumber" value.bind="employee.PassportNumber" placeholder="Passport number (if applicable)"
                                maxlength="10">
                        </div>

                        <div class="form-group">
                            <label for="HoursPerWeek">Hours per week</label>
                            <input type="number" class="form-control" id="HoursPerWeek" name="HoursPerWeek" value.bind="employee.HoursPerWeek & validate" placeholder="Hours per week"
                                min="0" max="168" step="0.5">

                            <span class="notes">
                                The employee's normal number of hours worked per week (irrespective of pay frequency).
                            </span>
                        </div>

                        <rule-exclusions ruleexclusions.bind="employee.RuleExclusions"></rule-exclusions>

                        <div class="form-group">
                            <label for="Seconded">Seconded</label>

                            <select class="form-control" id="Seconded" name="Seconded" value.bind="employee.Seconded">
                                <option value=""></option>
                                <option value="NotSet">Not set</option>
                                <option value="Stay183DaysOrMore">Stay 183 days or more</option>
                                <option value="StayLessThan183Days">Stay less than 183 days</option>
                                <option value="InOutUk">In out Uk</option>
                            </select>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="EEACitizen" name="EEACitizen" checked.bind="employee.EEACitizen">

                            <label class="form-check-label" for="EEACitizen">
                                Is a citizen of the European Economic Area?
                            </label>

                            <span class="notes">
                                Indicates if the seconded employee is a citizen of the European Economic Area.
                            </span>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="EPM6" name="EPM6" checked.bind="employee.EPM6">

                            <label class="form-check-label" for="EPM6">
                                Indicates if the seconded employee is under an EPM6 (Modified) Scheme for tax equalised expatriate employees.
                            </label>
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="WorkingWeek">Working week pattern</label>

                            <select class="form-control" id="WorkingWeek" name="WorkingWeek" multiple value.bind="employee.WorkingWeek">
                                <option value="AllWeekDays">All week days</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                                <option value="AllDays">All days</option>
                                <option value="None">None</option>
                            </select>

                            <span class="notes">
                                The employee's normal working week pattern.
                            </span>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="IsAgencyWorker" name="IsAgencyWorker" checked.bind="employee.IsAgencyWorker">

                            <label class="form-check-label" for="IsAgencyWorker">
                                Is an agency worker?
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="PaymentToANonIndividual" name="PaymentToANonIndividual" checked.bind="employee.PaymentToANonIndividual">

                            <label class="form-check-label" for="PaymentToANonIndividual">
                                Indicates where payments are made to a body, such as personal representative, trustee or corporate organisation.
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="IrregularEmployment" name="IrregularEmployment" checked.bind="employee.IrregularEmployment">

                            <label class="form-check-label" for="IrregularEmployment">
                                Indicates if the employee is paid on an irregular basis.
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="OnStrike" name="OnStrike" checked.bind="employee.OnStrike">

                            <label class="form-check-label" for="OnStrike">
                                Indicates if the employee's pay in this pay period has been reduced due to being on strike.
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input form-control-lg" type="checkbox" id="Deactivated" name="Deactivated" checked.bind="employee.Deactivated">
                            <label class="form-check-label" for="Deactivated">
                                Indicates if the employee is deactivated.
                            </label>
                            <span class="notes">Deactivated employees cannot be included in a pay run.</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="revisions" role="tabpanel" aria-labelledby="revisions-tab" if.bind="employee.Id">
                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label for="Revision">Revision</label>
                            
                            <input type="number" class="form-control" id="Revision" name="Revision" value.bind="employee.Revision" placeholder="Revision number"
                                readonly step="1" min="0">
                        </div>
                    </div>

                    <div class="col-sm-12 col-md-6" if.bind="employee.Revisions">
                        <h5>Revision History</h5>
                        <span class="notes">Employer revisions must be deleted in order, validation rules will prevent revisions being deleted if they invalidate an existing payrun.</span>
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Revision</th>
                                    <th>Effective Date</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr repeat.for="revision of employee.Revisions">
                                    <td>${revision.Revision}</td>
                                    <td>${revision.EffectiveDate}</td>
                                    <td class="text-right">
                                        <a class="btn btn-sm btn-danger" 
                                            href="#" 
                                            role="button" 
                                            click.delegate="deleteRevision(revision)">Delete</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>         
                    </div>
                </div>
            </div>            

            <div class="row" if.bind="showSaveButton">
                <div class="col-sm-12">
                    <hr>
                </div>
            </div>

            <div class="row" if.bind="showSaveButton">
                <div class="col-sm-12 text-right">
                    <button class="btn btn-primary" click.delegate="save()">Save</button>
                </div>
            </div>
        </div>
    </form>
</template>